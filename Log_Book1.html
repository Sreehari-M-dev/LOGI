<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Log Book</title>
    <script>
        // Auto-detect environment: use local servers for localhost/local IPs, Render for production
        (function() {
            const hostname = window.location.hostname;
            const isLocal = ['localhost', '127.0.0.1', '10.154.126.1'].includes(hostname) || hostname.startsWith('192.168.');
            if (isLocal) {
                // Use the same hostname/IP for local servers so it works from remote IPs too
                const host = hostname === 'localhost' ? 'localhost' : hostname;
                window.REACT_APP_AUTH_API = `http://${host}:3002/api/auth`;
                window.REACT_APP_LOGBOOK_API = `http://${host}:3005/api/logbook`;
            } else {
                window.REACT_APP_AUTH_API = 'https://logi-auth-service-avbs.onrender.com/api/auth';
                window.REACT_APP_LOGBOOK_API = 'https://logi-logbook-service-avbs.onrender.com/api/logbook';
            }
        })();
    </script> 
    <link rel="stylesheet" href="styles.css">
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- SheetJS for Excel Export/Import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html">Digital Lab Portal</a>
            </div>
            <button class="hamburger" id="hamburger" type="button" aria-label="Toggle navigation menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="Log_Book1.html" class="active">Log Book</a></li>
                <li><a href="Studyresources.html">Study Resources</a></li>
                <li><a href="About.html">About US</a></li>
                <li><a href="profile.html"><i class="fas fa-user-circle"></i> Profile</a></li>
            </ul>
        </div>
    </nav>

    <!-- Database Action Buttons -->
    <div class="logbook-actions">
        <h3><i class="fas fa-database"></i> Log Book Database Actions</h3>
        <div id="teacherActions" style="display: none;">
            <button type="button" class="btn-load" onclick="loadLogBookByRoll()">
                <i class="fas fa-user"></i> Load by Roll Number
            </button>
            <button type="button" class="btn-load-reg" onclick="loadLogBookByRegister()">
                <i class="fas fa-id-card"></i> Load by Register Number
            </button>
            <button type="button" class="btn-view" onclick="viewAllLogBooks()">
                <i class="fas fa-eye"></i> View All Log Books
            </button>
        </div>
        <div id="studentActions" style="display: none;">
            <button type="button" class="btn-view" onclick="loadMyLogBooks()">
                <i class="fas fa-list"></i> My Log Books
            </button>
            <button type="button" class="btn-load" onclick="createNewLogBook()">
                <i class="fas fa-plus"></i> Create New Log Book
            </button>
            <div style="padding: 15px; margin-top: 15px; background-color: #e8f5e9; border-radius: 8px; border-left: 4px solid #4caf50;">
                <p style="margin: 0; color: #2e7d32;"><strong>ℹ️ Note:</strong> Only faculty members can create new logbooks. If you need a logbook, please contact your faculty member.</p>
            </div>
        </div>
    </div>

    <!-- Excel Export/Import Section -->
    <div class="excel-actions">
        <h3><i class="fas fa-file-excel"></i> Local Backup (Excel)</h3>
        <p class="excel-info">Export your logbook to keep a verified backup on your device. Import to restore data with integrity check.</p>
        <div class="excel-buttons">
            <button type="button" class="btn-excel-export" onclick="exportLogbookToExcel()">
                <i class="fas fa-download"></i> Export to Excel
            </button>
            <button type="button" class="btn-excel-import" onclick="importLogbookFromExcel()">
                <i class="fas fa-upload"></i> Import from Excel
            </button>
        </div>
    </div>

    <!-- Student Logbook Selection Panel -->
    <div id="logbookSelectionPanel" style="display: none; padding: 20px; margin: 20px; background: #f8f9fa; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="margin-top: 0;"><i class="fas fa-books"></i> Your Log Books</h3>
        <div id="logbookList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;"></div>
        <button type="button" class="btn-load" onclick="createNewLogBook()" style="width: 100%; padding: 15px;">
            <i class="fas fa-plus"></i> Create New Log Book
        </button>
        
    </div>

    <!-- Student Logbook Form Container - Hidden for Faculty/Admin -->
    <div id="studentFormContainer" style="display: block;">
        <form id="logbookForm" onsubmit="return false;">
            <h1>Log Book</h1>
            
            <!-- Permission Indicator -->
            <div id="permissionIndicator" style="display: none; padding: 15px; margin: 20px 0; border-radius: 8px; font-weight: 600; text-align: center;"></div>
        
        <!-- Student Information -->
        <div class="table-scroll-wrapper">
        <table cellpadding="10px" class="ftab">
            <tr>
                <td><label for="name">Name of Student</label></td>
                <td><input type="text" id="name" name="name" readonly></td>
            </tr>
            <tr>
                <td><label for="rollno">Roll No</label></td>
                <td><input type="number" name="rollno" id="detail1" max="99" min="1" readonly></td>
                <td><label for="rgno">Register Number</label></td>
                <td><input type="number" name="rgno" id="detail" min="0" max="3000000000" readonly></td>
            </tr>
            <tr>
                <td><label for="subject">Subject/Course Name <span style="color: red;">*</span></label></td>
                <td><input type="text" id="subject" name="subject" required readonly></td>
                <td><label for="code">Subject Code</label></td>
                <td><input type="text" id="code" name="code" readonly></td>
            </tr>
        </table>
        </div>

        <!-- Lab Work Table -->
        <div class="table-scroll-wrapper">
        <table border="3" cellspacing="0" id="t1">
            <tr>
                <td rowspan="3"><b>Sl No</b></td>
                <td rowspan="3"><b>Date of Experiment</b></td>
                <td rowspan="3"><b>Name of Experiment</b></td>
                <td rowspan="3"><b>CO</b></td>
                <td colspan="6"><b>Marks Awarded for lab Work</b></td>
                <td rowspan="2" colspan="2"><b>Signature</b></td>
            </tr>
            <tr>
                <td colspan="5"><b>Rubrics</b></td>
                <td rowspan="2"><b>TOTAL</b></td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
                <td>5</td> 
                <td><b>Student</b></td>
                <td><b>Faculty</b></td>
            </tr>
            <tr>
                <td>1</td>
                <td><input type="date" name="date1"></td>
                <td><input type="text" name="experiment1" id="exp1"></td>
                <td><input type="number" name="co1" min="0" max="9"></td>
                <td><input type="number" name="rubric1-1"></td>
                <td><input type="number" name="rubric1-2"></td>
                <td><input type="number" name="rubric1-3"></td>
                <td><input type="number" name="rubric1-4"></td>
                <td><input type="number" name="rubric1-5"></td>
                <td><input type="number" name="total1" readonly></td>
                <td><input type="checkbox" name="student1"></td>
                <td><input type="checkbox" name="faculty1"></td>
            </tr>
            
            <tr>
                <td>2</td>
                <td><input type="date" name="date2"></td>
                <td><input type="text" name="experiment2" id="exp2"></td>
                <td><input type="number" name="co2" min="0" max="9"></td>
                <td><input type="number" name="rubric2-1"></td>
                <td><input type="number" name="rubric2-2"></td>
                <td><input type="number" name="rubric2-3"></td>
                <td><input type="number" name="rubric2-4"></td>
                <td><input type="number" name="rubric2-5"></td>
                <td><input type="number" name="total2" readonly></td>
                <td><input type="checkbox" name="student2"></td>
                <td><input type="checkbox" name="faculty2"></td>
            </tr>
            <tr>
                <td>3</td>
                <td><input type="date" name="date3"></td>
                <td><input type="text" name="experiment3" id="exp3"></td>
                <td><input type="number" name="co3" min="0" max="9"></td>
                <td><input type="number" name="rubric3-1"></td>
                <td><input type="number" name="rubric3-2"></td>
                <td><input type="number" name="rubric3-3"></td>
                <td><input type="number" name="rubric3-4"></td>
                <td><input type="number" name="rubric3-5"></td>
                <td><input type="number" name="total3" readonly></td>
                <td><input type="checkbox" name="student3"></td>
                <td><input type="checkbox" name="faculty3"></td>
            </tr>
            <tr>
                <td>4</td>
                <td><input type="date" name="date4"></td>
                <td><input type="text" name="experiment4" id="exp4"></td>
                <td><input type="number" name="co4" min="0" max="9"></td>
                <td><input type="number" name="rubric4-1"></td>
                <td><input type="number" name="rubric4-2"></td>
                <td><input type="number" name="rubric4-3"></td>
                <td><input type="number" name="rubric4-4"></td>
                <td><input type="number" name="rubric4-5"></td>
                <td><input type="number" name="total4" readonly></td>
                <td><input type="checkbox" name="student4"></td>
                <td><input type="checkbox" name="faculty4"></td>
            </tr>
            <tr>
                <td>5</td>
                <td><input type="date" name="date5"></td>
                <td><input type="text" name="experiment5" id="exp5"></td>
                <td><input type="number" name="co5" min="0" max="9"></td>
                <td><input type="number" name="rubric5-1"></td>
                <td><input type="number" name="rubric5-2"></td>
                <td><input type="number" name="rubric5-3"></td>
                <td><input type="number" name="rubric5-4"></td>
                <td><input type="number" name="rubric5-5"></td>
                <td><input type="number" name="total5" readonly></td>
                <td><input type="checkbox" name="student5"></td>
                <td><input type="checkbox" name="faculty5"></td>
            </tr>
            <tr>
                <td>6</td>
                <td><input type="date" name="date6"></td>
                <td><input type="text" name="experiment6" id="exp6"></td>
                <td><input type="number" name="co6" min="0" max="9"></td>
                <td><input type="number" name="rubric6-1"></td>
                <td><input type="number" name="rubric6-2"></td>
                <td><input type="number" name="rubric6-3"></td>
                <td><input type="number" name="rubric6-4"></td>
                <td><input type="number" name="rubric6-5"></td>
                <td><input type="number" name="total6" readonly></td>
                <td><input type="checkbox" name="student6"></td>
                <td><input type="checkbox" name="faculty6"></td>
            </tr>
            <tr>
                <td>7</td>
                <td><input type="date" name="date7"></td>
                <td><input type="text" name="experiment7" id="exp7"></td>
                <td><input type="number" name="co7" min="0" max="9"></td>
                <td><input type="number" name="rubric7-1"></td>
                <td><input type="number" name="rubric7-2"></td>
                <td><input type="number" name="rubric7-3"></td>
                <td><input type="number" name="rubric7-4"></td>
                <td><input type="number" name="rubric7-5"></td>
                <td><input type="number" name="total7" readonly></td>
                <td><input type="checkbox" name="student7"></td>
                <td><input type="checkbox" name="faculty7"></td>
            </tr>
            <!-- <tr>
                <td colspan="4"><button id="addrow" onclick="addRow(event)">Add Row</button></td>
                <td colspan="8"><button id="delrow" onclick="delRow(event)">Delete Row</button></td>
            </tr> -->
        </table>
        </div>

        <!-- Open Ended Project Table -->
        <div class="table-scroll-wrapper">
        <table border="1" cellspacing="5">
            <tr><td colspan="12" class="open-ended-project"><b>Open Ended Project</b></td></tr>
            <tr>
                <td rowspan="3"><b>Sl No</b></td>
                <td rowspan="3"><b>Date of Project</b></td>
                <td rowspan="3"><b>Project</b></td>
                <td rowspan="3"><b>CO</b></td>
                <td colspan="6"><b>Marks Awarded for lab Work</b></td>
                <td rowspan="2" colspan="2"><b>Signature</b></td>
            </tr>
            <tr>
                <td colspan="5"><b>Rubrics</b></td>
                <td rowspan="2"><b>TOTAL</b></td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
                <td>5</td>
                <td><b>Student</b></td>
                <td><b>Faculty</b></td>
            </tr>
            <tr>
                <td>1</td>
                <td><input type="date" name="t2date1"></td>
                <td><input type="text" name="t2experiment1" id="t2exp1"></td>
                <td><input type="number" name="t2co1" min="0" max="9"></td>
                <td><input type="number" name="t2rubric1-1"></td>
                <td><input type="number" name="t2rubric1-2"></td>
                <td><input type="number" name="t2rubric1-3"></td>
                <td><input type="number" name="t2rubric1-4"></td>
                <td><input type="number" name="t2rubric1-5"></td>
                <td><input type="number" name="t2total1" readonly></td>
                <td><input type="checkbox" name="t2student1"></td>
                <td><input type="checkbox" name="t2faculty1"></td>
            </tr>
        </table>
        </div>

        <!-- Lab Exam Table -->
        <div class="table-scroll-wrapper">
        <table border="1" cellspacing="0">
            <tr><td colspan="12" class="lab-exam-header"><b>Lab Exam</b></td></tr>
            <tr>
                <td rowspan="3"><b>Sl No</b></td>
                <td rowspan="3"><b>Date of Exam</b></td>
                <td rowspan="3"><b>Exam</b></td>
                <td rowspan="3"><b>CO</b></td>
                <td colspan="6"><b>Marks Awarded for lab Work</b></td>
                <td rowspan="2" colspan="2"><b>Signature</b></td>
            </tr>
            <tr>
                <td colspan="5"><b>Rubrics</b></td>
                <td rowspan="2"><b>TOTAL</b></td>
            </tr>
            <tr>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
                <td>5</td> 
                <td><b>Student</b></td>
                <td><b>Faculty</b></td>
            </tr>
            <tr>
                <td>1</td>
                <td><input type="date" name="t3date1"></td>
                <td><input type="text" name="exam1" id="exam1"></td>
                <td><input type="number" name="t3co1" min="0" max="9"></td>
                <td><input type="number" name="t3rubric1-1"></td>
                <td><input type="number" name="t3rubric1-2"></td>
                <td><input type="number" name="t3rubric1-3"></td>
                <td><input type="number" name="t3rubric1-4"></td>
                <td><input type="number" name="t3rubric1-5"></td>
                <td><input type="number" name="t3total1" readonly></td>
                <td><input type="checkbox" name="t3student1"></td>
                <td><input type="checkbox" name="t3faculty1"></td>
            </tr>
            <tr>
                <td>2</td>
                <td><input type="date" name="t3date2"></td>
                <td><input type="text" name="exam2" id="exam2"></td>
                <td><input type="number" name="t3co2" min="0" max="9"></td>
                <td><input type="number" name="t3rubric2-1"></td>
                <td><input type="number" name="t3rubric2-2"></td>
                <td><input type="number" name="t3rubric2-3"></td>
                <td><input type="number" name="t3rubric2-4"></td>
                <td><input type="number" name="t3rubric2-5"></td>
                <td><input type="number" name="t3total2" readonly></td>
                <td><input type="checkbox" name="t3student2"></td>
                <td><input type="checkbox" name="t3faculty2"></td>
            </tr>
            <tr>
                <td>3</td>
                <td><input type="date" name="t3date3"></td>
                <td><input type="text" name="exam3" id="exam3"></td>
                <td><input type="number" name="t3co3" min="0" max="9"></td>
                <td><input type="number" name="t3rubric3-1"></td>
                <td><input type="number" name="t3rubric3-2"></td>
                <td><input type="number" name="t3rubric3-3"></td>
                <td><input type="number" name="t3rubric3-4"></td>
                <td><input type="number" name="t3rubric3-5"></td>
                <td><input type="number" name="t3total3" readonly></td>
                <td><input type="checkbox" name="t3student3"></td>
                <td><input type="checkbox" name="t3faculty3"></td>
            </tr>
        </table>
        </div>

        <!-- Final Assessment Table -->
        <center>
            <div class="table-scroll-wrapper">
            <table border="1" cellspacing="0">
                <tr>
                    <td colspan="10" class="final-assessment-header"><b>Final Assessment</b></td>
                </tr>
                <tr>
                    <td colspan="2"></td>
                    <td>Maximum Marks</td>
                    <td>Marks Awarded</td>
                </tr>
                <tr>
                    <td rowspan="2" colspan="2">Attendance</td>
                    <td>15</td> 
                    <td><input type="text" name="final1"></td>
                </tr>
                <tr>
                    <td rowspan="3">Formative Assessment</td>
                </tr>
                <tr>
                    <td>Lab Work</td>
                    <td>37.5</td>
                    <td><input type="text" name="final2"></td>
                </tr>
                <tr>
                    <td>Open Ended Project</td>
                    <td>7.5</td>
                    <td><input type="text" name="final3"></td>
                </tr>
                <tr>
                    <td rowspan="2">Summative Assessment</td>
                </tr>
                <tr>
                    <td>Lab Exam</td>
                    <td>15</td>
                    <td><input type="text" name="final4"></td>
                </tr>
                <tr>
                    <td colspan="2">Total Marks</td>
                    <td>75</td>
                    <td><input type="text" name="final5" readonly style="background: #f0f0f0; font-weight: bold;"></td>
                </tr>
                <tr>
                    <td colspan="2"><b>Verification Signature</b></td>
                    <td><b>Student</b> <input type="checkbox" name="finalStudentSignature" title="Student verification"></td>
                    <td><b>Faculty</b> <input type="checkbox" name="finalFacultySignature" title="Faculty verification"></td>
                </tr>
            </table>
            </div>
            <br><br>
            <input type="submit" value="Submit" name="submit" id="submitBtn">
        </center>
        </form>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.all.min.js"></script>
    <!-- Error Handler (User-Friendly Messages) -->
    <script src="error-handler.js"></script>
    <script src="auth.js"></script>
    <script src="scripts.js"></script>
    <script src="logbook-client.js"></script>
    <!-- Logbook Excel Export/Import with Integrity Protection -->
    <script src="logbook-excel.js"></script>
</body>

</html>


