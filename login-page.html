<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - LOGI | Digital Lab Logbook System</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Login to LOGI - Digital Lab Logbook Management System. Access your lab experiments, track progress, and manage laboratory documentation.">
    <meta name="keywords" content="LOGI login, lab logbook login, student portal, faculty login, lab management">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://sreehari-m-dev.github.io/LOGI/login-page.html">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Login - LOGI Digital Lab Logbook">
    <meta property="og:description" content="Access your lab experiments and documentation with LOGI.">
    <meta property="og:url" content="https://sreehari-m-dev.github.io/LOGI/login-page.html">
    <meta property="og:image" content="https://sreehari-m-dev.github.io/LOGI/c-logo.png">
    
    <script>
        // Auto-detect environment: use local servers for localhost, Render for production
        (function() {
            const isLocal = ['localhost', '127.0.0.1'].includes(window.location.hostname);
            if (isLocal) {
                window.REACT_APP_AUTH_API = 'http://localhost:3002/api/auth';
                window.REACT_APP_LOGBOOK_API = 'http://localhost:3005/api/logbook';
            } else {
                window.REACT_APP_AUTH_API = 'https://logi-auth-service-avbs.onrender.com/api/auth';
                window.REACT_APP_LOGBOOK_API = 'https://logi-logbook-service-avbs.onrender.com/api/logbook';
            }
        })();
    </script>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at 20% 20%, rgba(102, 126, 234, 0.18), transparent 30%),
                        radial-gradient(circle at 80% 0%, rgba(76, 201, 240, 0.2), transparent 28%),
                        linear-gradient(135deg, #0f172a 0%, #0b2b2d 40%, #0c4335 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px;
            color: #0b1d1f;
        }        
        .auth-shell {
            width: 100%;
            max-width: 1100px;
            display: grid;
            grid-template-columns: 1.05fr 0.95fr;
            gap: 32px;
            align-items: center;
            position: relative;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            overflow: hidden;
        }

        .hero-panel {
            position: relative;
            padding: 48px 44px;
            color: #0e1f1f;
            background: linear-gradient(145deg, #d7f7ec 0%, #eaf3ff 40%, #d6e5ff 100%);
            min-height: 520px;
        }

        .hero-kicker {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: rgba(12, 67, 53, 0.08);
            color: #0b4335;
            border-radius: 999px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .hero-title {
            margin: 18px 0 10px;
            font-size: 34px;
            font-weight: 700;
            color: #0e1f1f;
            line-height: 1.2;
        }

        .hero-sub {
            color: #244a4b;
            font-size: 16px;
            max-width: 460px;
            line-height: 1.6;
        }

        .hero-figure {
            margin-top: 28px;
            background: linear-gradient(135deg, #0b4335 0%, #0f5f5a 60%, #0b1d1f 100%);
            border-radius: 18px;
            padding: 28px;
            position: relative;
            overflow: hidden;
            min-height: 280px;
        }

        .hero-figure svg {
            width: 100%;
            height: 240px;
            display: block;
        }

        .hero-badge {
            position: absolute;
            top: 18px;
            right: 18px;
            background: rgba(255, 255, 255, 0.9);
            color: #0b4335;
            padding: 10px 14px;
            border-radius: 14px;
            font-weight: 700;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
        }

        .login-panel {
            padding: 44px 42px;
            max-width: 520px;
            margin-left: auto;
        }

        .login-header {
            text-align: left;
            margin-bottom: 30px;
        }
        
        .login-header h1 {
            color: #0f4335;
            font-size: 30px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.3px;
        }
        
        .login-header p {
            color: #516164;
            font-size: 15px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #1b2a2c;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e6eef0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.25s ease;
            font-family: inherit;
            background: #f9fbfc;
            text-align: center;
            letter-spacing: normal;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #36ba86;
            box-shadow: 0 0 0 4px rgba(54, 186, 134, 0.15);
            background: #fff;
        }
        
        .form-group input::placeholder {
            color: #9aa9ad;
        }
        
        .password-toggle {
            position: relative;
        }
        
        .password-toggle-icon {
            position: absolute;
            right: 14px;
            top: 44px;
            cursor: pointer;
            color: #6b7c80;
            transition: color 0.25s ease;
        }
        
        .password-toggle-icon:hover {
            color: #0f4335;
        }
        
        .submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(120deg, #36ba86 0%, #1fb5a3 60%, #1e8f71 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 6px;
            box-shadow: 0 12px 28px rgba(31, 181, 163, 0.35);
        }
        
        .submit-btn:hover {
            transform: translateY(-1px) scale(1.005);
            box-shadow: 0 14px 30px rgba(31, 181, 163, 0.45);
        }
        
        .submit-btn:active {
            transform: translateY(0);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .form-footer {
            text-align: left;
            margin-top: 12px;
            font-size: 14px;
            color: #607274;
        }
        
        .form-footer a {
            color: #0f7f61;
            text-decoration: none;
            font-weight: 600;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            background: #ffecec;
            color: #c0392b;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 18px;
            display: none;
            font-size: 14px;
            border: 1px solid #ffd1d1;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #0f7f61;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e0e0e0;
            border-top-color: #0f7f61;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="auth-shell">
        <div class="glass-card hero-panel">
            <div class="hero-kicker"><i class="fas fa-seedling"></i> Digital Lab Portal</div>
            <div class="hero-title">Welcome back to LOGI</div>
            <p class="hero-sub">Track experiments, sync logbooks, and collaborate with faculty in a refreshed, modern workspace.</p>
            <div class="hero-figure">
                <div class="hero-badge"><i class="fas fa-shield-heart"></i> Secure Access</div>
                <svg viewBox="0 0 420 260" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#34d399"/>
                            <stop offset="100%" stop-color="#0ea5e9"/>
                        </linearGradient>
                        <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#0ea5e9" stop-opacity="0.9"/>
                            <stop offset="100%" stop-color="#7c3aed" stop-opacity="0.85"/>
                        </linearGradient>
                    </defs>
                    <path d="M30 210 Q110 120 220 190 T390 170" fill="none" stroke="#8be9d0" stroke-width="12" stroke-linecap="round" stroke-dasharray="10 16" opacity="0.7"/>
                    <rect x="82" y="62" rx="16" ry="16" width="180" height="120" fill="#0b1d1f" stroke="#63f3c3" stroke-width="3" opacity="0.9"/>
                    <rect x="95" y="78" rx="10" ry="10" width="80" height="20" fill="#0ea5e9" opacity="0.85"/>
                    <rect x="95" y="108" rx="10" ry="10" width="120" height="20" fill="#22d3ee" opacity="0.75"/>
                    <rect x="95" y="138" rx="10" ry="10" width="150" height="20" fill="#34d399" opacity="0.8"/>
                    <circle cx="280" cy="112" r="48" fill="url(#grad1)" opacity="0.95"/>
                    <path d="M260 112 l18 18 32-36" fill="none" stroke="#0b1d1f" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="330" cy="70" r="18" fill="url(#grad2)" opacity="0.9"/>
                    <path d="M328 66 v8 m4-4 h-8" stroke="#0b1d1f" stroke-width="4" stroke-linecap="round"/>
                </svg>
            </div>
        </div>

        <div class="glass-card login-panel">
            <div class="login-header">
                <h1><i class="fas fa-lock"></i> Login</h1>
                <p>Sign in to manage your logbooks</p>
            </div>
            
            <div id="loginError" class="error-message"></div>
            
            <form onsubmit="handleLogin(event)" autocomplete="off">
                <div class="form-group">
                    <label for="loginRgno"><i class="fas fa-id-card"></i> Register Number</label>
                    <input type="number" id="loginRgno" name="rgno" placeholder="Enter your register number" required autofocus autocomplete="off">
                </div>
                
                <div class="form-group password-toggle">
                    <label for="loginPassword"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required autocomplete="new-password">
                    <span class="password-toggle-icon" onclick="togglePasswordVisibility('loginPassword')">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <div class="loading" id="loginLoading">
                    <span class="spinner"></span> Logging in...
                </div>
                
                <button type="submit" class="submit-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            <div class="form-footer" style="margin-top:12px;">
                <a href="forgot-password.html">Forgot Password?</a>
            </div>
            <div class="form-footer" style="margin-top:8px;">
                Don't have an account? <a href="register.html">Register here</a>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.all.min.js"></script>
    <script>
        const AUTH_API = window.REACT_APP_AUTH_API || 'http://localhost:3002/api/auth'; 
        
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = event.target.closest('.password-toggle-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                input.type = 'password';
                icon.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        async function handleLogin(e) {
            e.preventDefault();
            
            const rgno = document.getElementById('loginRgno').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const loadingDiv = document.getElementById('loginLoading');
            const submitBtn = document.getElementById('loginBtn');
            
            errorDiv.style.display = 'none';
            loadingDiv.style.display = 'block';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch(`${AUTH_API}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rgno: parseInt(rgno), password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Store token
                    localStorage.setItem('token', result.token);
                    localStorage.setItem('user', JSON.stringify(result.user));
                    
                    Swal.fire({
                        title: 'Success!',
                        text: 'Login successful. Redirecting...',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = 'Log_Book1.html';
                    });
                } else {
                    errorDiv.textContent = result.error;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'Error: ' + error.message;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
                submitBtn.disabled = false;
            }
        }
        
        // Check if already logged in
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            if (token) {
                window.location.href = 'Log_Book1.html';
            }
            
            // Check for logout reason and display popup
            const logoutReason = sessionStorage.getItem('logoutReason');
            if (logoutReason) {
                sessionStorage.removeItem('logoutReason');
                
                Swal.fire({
                    title: 'Logged Out',
                    text: logoutReason,
                    icon: logoutReason.includes('inactivity') ? 'warning' : 'info',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#3498db'
                });
            }
        });
    </script>
</body>
</html>
